{% extends "crime_app/officerPage/main.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<!-- ===================== Page Container ===================== -->
<div class="min-h-screen bg-gray-100 p-6">
  <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-md overflow-hidden border border-gray-200">

    <!-- ✅ Header Buttons -->
    <div class="flex justify-between items-center bg-blue-600 text-white px-6 py-4">
      <h1 class="text-2xl font-bold tracking-wide">Crime Reports</h1>

      <div class="space-x-3">
        <button id="showTableBtn"
          class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg shadow transition">
          📋 View Reports
        </button>
        <button id="showFormBtn"
          class="bg-white text-blue-700 hover:bg-gray-100 px-4 py-2 rounded-lg shadow transition">
          📝 New Report
        </button>
      </div>
    </div>

    <!-- ===================== Reports Table Section ===================== -->
    <div id="reportTableSection" class="p-6 overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="px-4 py-3 font-semibold text-gray-600">#</th>
            <th class="px-4 py-3 font-semibold text-gray-600">Title</th>
            <th class="px-4 py-3 font-semibold text-gray-600">Department</th>
            <th class="px-4 py-3 font-semibold text-gray-600">Status</th>
            <th class="px-4 py-3 font-semibold text-gray-600">Date</th>
            <th class="px-4 py-3 font-semibold text-gray-600">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for report in reports %}
          <tr class="border-b hover:bg-gray-50">
            <td class="px-4 py-3">{{ forloop.counter }}</td>
            <td class="px-4 py-3 font-medium text-gray-800">{{ report.title }}</td>
            <td class="px-4 py-3">{{ report.department.name }}</td>
            <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold {% if report.status == 'Pending' %}bg-yellow-100 text-yellow-700{% elif report.status == 'Resolved' %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-700{% endif %}">
                {{ report.status }}
              </span>
            </td>
            <td class="px-4 py-3 text-gray-600">{{ report.date_reported|date:"M d, Y" }}</td>
            <td class="px-4 py-3">
              <a href="{% url 'report-detail' report.id %}"
                class="text-blue-600 hover:underline font-medium">View</a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center py-6 text-gray-500">No reports available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ===================== Report Form Section ===================== -->
    <div id="reportFormSection" class="hidden min-h-[80vh] flex flex-col justify-center items-center bg-gray-50 p-10">
      <div class="w-full max-w-3xl bg-white p-8 rounded-2xl shadow-md border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">📝 Submit New Crime Report</h2>

        <form method="POST" enctype="multipart/form-data" class="space-y-5">
          {% csrf_token %}
          {{ form|crispy }}

          <div class="flex justify-center space-x-4 mt-8">
            <button type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow transition">
              Submit Report
            </button>
            <button type="button" id="cancelFormBtn"
              class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg shadow transition">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>

<!-- ===================== Script Section ===================== -->
<script>
  const formSection = document.getElementById('reportFormSection');
  const tableSection = document.getElementById('reportTableSection');
  const showFormBtn = document.getElementById('showFormBtn');
  const showTableBtn = document.getElementById('showTableBtn');
  const cancelFormBtn = document.getElementById('cancelFormBtn');

  // Default: show table, hide form
  tableSection.classList.remove('hidden');
  formSection.classList.add('hidden');
  showTableBtn.classList.add('bg-blue-700', 'text-white');

  showFormBtn.onclick = () => {
    formSection.classList.remove('hidden');
    tableSection.classList.add('hidden');
    showFormBtn.classList.add('bg-blue-700', 'text-white');
    showTableBtn.classList.remove('bg-blue-700', 'text-white');
  };

  showTableBtn.onclick = () => {
    tableSection.classList.remove('hidden');
    formSection.classList.add('hidden');
    showTableBtn.classList.add('bg-blue-700', 'text-white');
    showFormBtn.classList.remove('bg-blue-700', 'text-white');
  };

  cancelFormBtn.onclick = () => {
    showTableBtn.click(); // Return to table view
  };
</script>

{% endblock %}
