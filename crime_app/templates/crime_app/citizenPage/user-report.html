{% extends "crime_app/citizenPage/maain.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}


    <div id="reportFormSection" class="hidden min-h-[80vh] flex flex-col justify-center items-center bg-gray-50 p-10">
  <div class="w-full max-w-6xl bg-white p-8 rounded-2xl shadow-md border border-gray-200">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üìù Submit New Crime Report</h2>

    <form method="POST" enctype="multipart/form-data" class="space-y-5">
      {% csrf_token %}
      
      <!-- Two-column form layout -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Left Column -->
        <div class="space-y-4">
          {% for field in form %}
            {% if forloop.counter0|divisibleby:2 %}  <!-- Even indices (0, 2, 4...) -->
              <div class="form-group">
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                  {{ field.label }}
                  {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                </label>
                
                {% if field.name == "department" or field.name == "incident_type" %}
                  <!-- Select field for department and incident_type -->
                  <select name="{{ field.name }}" 
                          id="{{ field.id_for_label }}" 
                          class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          {% if field.field.required %}required{% endif %}>
                    <option value="">Select {{ field.label }}</option>
                    {% for choice in field.field.choices %}
                      {% if choice.0 != '' %}
                        <option value="{{ choice.0 }}" {% if field.value|stringformat:"s" == choice.0|stringformat:"s" %}selected{% endif %}>
                          {{ choice.1 }}
                        </option>
                      {% endif %}
                    {% endfor %}
                  </select>
                {% else %}
                  <!-- Regular input field -->
                  <input type="{{ field.field.widget.input_type }}" 
                         name="{{ field.name }}" 
                         id="{{ field.id_for_label }}" 
                         class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                         value="{{ field.value|default:'' }}"
                         {% if field.field.required %}required{% endif %}>
                {% endif %}
                
                {% if field.help_text %}
                  <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                {% endif %}
                {% for error in field.errors %}
                  <p class="text-xs text-red-500 mt-1">{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        
        <!-- Right Column -->
        <div class="space-y-4">
          {% for field in form %}
            {% if not forloop.counter0|divisibleby:2 %}  <!-- Odd indices (1, 3, 5...) -->
              <div class="form-group">
                <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                  {{ field.label }}
                  {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
                </label>
                
                {% if field.name == "department" or field.name == "incident_type" %}
                  <!-- Select field for department and incident_type -->
                  <select name="{{ field.name }}" 
                          id="{{ field.id_for_label }}" 
                          class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          {% if field.field.required %}required{% endif %}>
                    <option value="">Select {{ field.label }}</option>
                    {% for choice in field.field.choices %}
                      {% if choice.0 != '' %}
                        <option value="{{ choice.0 }}" {% if field.value|stringformat:"s" == choice.0|stringformat:"s" %}selected{% endif %}>
                          {{ choice.1 }}
                        </option>
                      {% endif %}
                    {% endfor %}
                  </select>
                {% else %}
                  <!-- Regular input field -->
                  <input type="{{ field.field.widget.input_type }}" 
                         name="{{ field.name }}" 
                         id="{{ field.id_for_label }}" 
                         class="border border-gray-300 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                         value="{{ field.value|default:'' }}"
                         {% if field.field.required %}required{% endif %}>
                {% endif %}
                
                {% if field.help_text %}
                  <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                {% endif %}
                {% for error in field.errors %}
                  <p class="text-xs text-red-500 mt-1">{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- ‚úÖ Multimedia Evidence Section (Full width) -->
      <div class="border-t pt-6 mt-6">
          <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">üì∑ Multimedia Evidence</h3>

          <!-- Three columns in one line -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              
              <!-- Photo Capture Column -->
              <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center h-full">
                  <h4 class="font-semibold text-gray-700 mb-3">üì∏ Photo</h4>
                  <video id="cameraPreview" class="mx-auto rounded-md hidden w-full max-w-xs" autoplay></video>
                  <canvas id="photoCanvas" class="hidden"></canvas>
                  <div id="photoPreviewContainer" class="my-3"></div>

                  <div class="space-y-2">
                      <button type="button" id="openCameraBtn"
                          class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Open Camera
                      </button>
                      <button type="button" id="takePhotoBtn"
                          class="hidden bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Take Photo
                      </button>
                  </div>

                  <input type="file" name="photo_file" id="photoFileInput" accept="image/*" class="hidden" />
              </div>

              <!-- Video Recording Column -->
              <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center h-full">
                  <h4 class="font-semibold text-gray-700 mb-3">üé• Video</h4>
                  <video id="videoPreview" class="mx-auto rounded-md hidden w-full max-w-xs" controls></video>
                  
                  <div class="space-y-2">
                      <button type="button" id="startVideoBtn"
                          class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Start Recording
                      </button>
                      <button type="button" id="stopVideoBtn"
                          class="hidden bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Stop Recording
                      </button>
                  </div>

                  <input type="file" name="video_file" id="videoFileInput" accept="video/*" class="hidden" />
              </div>

              <!-- Audio Recording Column -->
              <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center h-full">
                  <h4 class="font-semibold text-gray-700 mb-3">üé§ Audio</h4>
                  <audio id="audioPreview" class="mx-auto hidden w-full" controls></audio>
                  
                  <div class="space-y-2">
                      <button type="button" id="startAudioBtn"
                          class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Record Voice
                      </button>
                      <button type="button" id="stopAudioBtn"
                          class="hidden bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow text-sm w-full">
                          Stop
                      </button>
                  </div>

                  <input type="file" name="audio_file" id="audioFileInput" accept="audio/*" class="hidden" />
              </div>
          </div>
      </div>
      <!-- Submit Buttons -->
      <div class="flex justify-center space-x-4 mt-8">
        <button type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow transition">
          Submit Report
        </button>
        <button type="button" id="cancelFormBtn"
          class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg shadow transition">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

{% endblock %}